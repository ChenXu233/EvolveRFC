# EvolveRFC 工作流配置
# 角色支持动态配置，可随时启用/禁用/添加

# ============================================
# 路由规则配置
# ============================================
routing:
  max_rounds: 10              # 最大讨论轮次
  round_timeout_minutes: 30   # 人类决策超时时间（分钟）

  # 路由规则（按优先级排序，数字越小优先级越高）
  rules:
    - name: emergency_stop
      condition: "human_decision.action == 终止"
      priority: 1

    - name: human_intervention
      condition: "awaiting_human_input == true"
      priority: 2

    - name: max_rounds_reached
      condition: "current_round >= max_rounds"
      priority: 3

    - name: consensus_reached
      condition: "open_issues is empty"
      priority: 4

# ============================================
# 投票阈值配置
# ============================================
thresholds:
  deadlock_opposition_ratio: 0.3   # 反对票比例超过此值视为僵局，需人类介入
  consensus_quorum: 0.8            # 赞成票比例达到此值即达成共识

# ============================================
# 全局 LLM 配置
# ============================================
# 所有角色的默认配置，未在角色中单独配置时使用
llm:
  provider: openai            # openai | anthropic
  model: gpt-4o               # 模型名称
  temperature: 0.7            # 0.0-2.0，值越高越有创意
  # base_url: https://api.openai.com/v1  # 可选：代理地址或第三方兼容 API
  # timeout: 60.0             # Anthropic 超时时间（秒）
  # stop: ["\n\n"]            # Anthropic 停止词列表
  # api_key: ""               # API 密钥（敏感信息，会被 .gitignore 忽略）

# ============================================
# 角色配置（动态配置，支持添加/删除/自定义）
# ============================================
roles:
  # === 首席架构师 ===
  # 职责：评估架构设计、识别技术债务、检查 SOLID 原则
  architect:
    enabled: true
    must_speak: true      # 必须发言
    can_vote: true        # 有投票权
    prompt_file: prompts/architect.txt
    # 可选：覆盖全局 LLM 设置
    # llm:
    #   provider: openai
    #   model: gpt-4o
    #   temperature: 0.7
    #   base_url: https://api.openai.com/v1  # 代理地址
    #   api_key: ""  # 可选：角色专属 API 密钥

  # === 安全偏执狂 ===
  # 职责：识别安全漏洞、检查数据保护、评估认证授权
  security:
    enabled: true
    must_speak: true
    can_vote: true
    prompt_file: prompts/security.txt
    # 使用 Claude 进行更深入的安全分析
    llm:
      provider: anthropic
      model: claude-sonnet-4-20250514
      temperature: 0.3  # 安全分析需要更低的温度
      # base_url: https://api.anthropic.com  # Anthropic API 地址
      # api_key: ""  # 可选：角色专属 API 密钥

  # === 成本控制型运维 ===
  # 职责：评估基础设施成本、检查运维复杂度、监控可观测性
  cost_control:
    enabled: true
    must_speak: true
    can_vote: true
    prompt_file: prompts/cost_control.txt
    # 可选：使用更便宜的模型
    # llm:
    #   provider: openai
    #   model: gpt-4o-mini
    #   temperature: 0.5
    #   api_key: ""  # 可选：角色专属 API 密钥

  # === 激进创新派 ===
  # 职责：评估新技术可能性、挑战保守设计、提出创新建议
  innovator:
    enabled: true
    must_speak: false     # 可选发言（但仍有投票权）
    can_vote: true        # 显式声明有投票权
    prompt_file: prompts/innovator.txt
    # 可选：使用更具创意的模型配置
    # llm:
    #   provider: openai
    #   model: gpt-4o
    #   temperature: 1.0  # 更高的温度产生更多创意
    #   api_key: ""  # 可选：角色专属 API 密钥

  # === 书记官 ===
  # 职责：总结讨论、提炼共识、起草报告（不参与投票）
  clerk:
    enabled: true
    must_speak: false
    can_vote: false       # 明确无投票权
    prompt_file: prompts/clerk.txt
    # 可选：使用较短的上下文窗口
    # llm:
    #   provider: openai
    #   model: gpt-4o-mini
    #   api_key: ""  # 可选：角色专属 API 密钥

# ============================================
# API 密钥配置（敏感信息，会被 .gitignore 忽略）
# ============================================
# 优先级：角色配置 > 环境变量 > 全局配置
# 建议优先使用环境变量，其次在角色配置中指定
#
# 环境变量设置：
# export OPENAI_API_KEY="sk-..."
# export ANTHROPIC_API_KEY="sk-ant-..."
